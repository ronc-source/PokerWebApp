<!DOCTYPE html>
<html>
  <head>
    <meta charset = "utf-8">
    <!-- Script for websocket communication, using the socket.io library to request a certain file-->
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.5.1/socket.io.min.js">
    </script>
    <!-- second script to initialize websocket connection between client and server-->
    <script>
      //Important code to setup a socket connection for whoever accesses the client web page
      var socket = io();
      //Users cards for the game
      var myCards = [];

      //variable function to be used to send message to the server from clicking the button (Passes button id as paraemeter)
      var userClicked = function(buttonId){
        //users cannot click on a seat thats already "locked in" -> wont send msg to server
        if (document.getElementById(buttonId).innerText != "Locked"){
          socket.emit('joining', {
          reason: buttonId
        });
        }
      }


      socket.on('LobbyState',function(seatsList){
        for (var i = 0; i < seatsList.length; i++){
          console.log(seatsList[i]);
          generateButtId = "seat" + (i + 1);
          if (seatsList[i] == 0){ //seat is empty
            document.getElementById(generateButtId).innerText = "Join";
          }
          else{ //seat is being used
            document.getElementById(generateButtId).innerText = "Locked";
          }
        }

        //Update the 'waiting...' text to 'ready' and vice versa
        var firstButton = document.getElementById("seat1");
        var secondButton = document.getElementById("seat2");

        if(firstButton.innerText == secondButton.innerText && firstButton.innerText == "Locked")
        {
          document.getElementById("loadingText").innerText = "Ready";
          //Send a message to the server to start the game
          socket.emit('startGame', "");
        }
        else{
          document.getElementById("loadingText").innerText = "Waiting...";
        }

      });

      //Listen for server messages to update the chat for the client
      socket.on('addToChat', function(data){
        var chatText = document.getElementById('chat-text');
        chatText.innerHTML += "<div>" + data + "</div>";
      });

      //Called when the form is submitted, sends a message to the server to add any messages the user has into the chat box
      function userSubmission()
      {
        var chatInput = document.getElementById("chat-input").value;
        socket.emit('sendMsgToServer', chatInput);
        //Prevent user from refreshing the page (disconnecting) when pressing enter to submit chat
        return false;
      }

      //Listen for the message 'addStartingCards' to distribute shuffled cards to the client
      socket.on('addStartingCards', function(data){
        //Item format in myCards: { value: 'Ace', suit: 'Clubs' }
        myCards.push(data);

        //Display 2 cards to the users
        if(myCards.length == 2){
          var firstCard = document.getElementById("first-card");
          var secondCard = document.getElementById("second-card");

          //If user is not given a number card

          //PROBLEM: myCards[0] == null after 6-8 refreshes

          if(myCards[0] != null){
              firstCard.src = "/client/img/cards_png/" + myCards[0]["value"] + myCards[0]["suit"] + ".png";
              secondCard.src = "/client/img/cards_png/" + myCards[1]["value"] + myCards[1]["suit"]+ ".png";
          }
        }

      });




    </script>

    <!-- CSS Code -->
    <style>

      .container{
        position: relative;
      }

      .container .display{
        position: absolute;
        left: 380px;
      }

      .container .btn1 {
        position: absolute;
        left: 385px;
        top: 300px;
      }

      .container .btn2 {
        position: absolute;
        left: 650px;
        top: 200px;
      }

      .container .chips{
        position: absolute;
        width: 75px;
        height: 75px;
        top: 430px;
      }

    </style>

  </head>

  <body>
    <div class = "container">

      <!-- Lobby HTML contents and poker table -->
      <div>
        <h2 id = "loadingText" class = "display"> Waiting... </h2>
        <img src = "/client/img/GameTable.jpg">
        <button onclick = "userClicked(this.id)" id = "seat1" class = "btn1"> Join </button>
        <button onclick = "userClicked(this.id)" id = "seat2" class = "btn2"> Join </button>
      </div>

      <!-- Display cards and chips for the user -->
      <div>
        <strong>Your Cards</strong>
        <br>
        <img id = "first-card" style = "width: 100px; height: 150px;">
        <img id = "second-card" style = "width: 100px; height: 150px;">

        <div>
          <img src = "/client/img/BlackChip.jpg" class = "chips" style = "left: 250px;">
          <img src = "/client/img/BlueChip.jpg" class = "chips" style = "left: 360px;">
          <img src = "/client/img/GreenChip.PNG" class = "chips" style = "left: 470px;">
          <img src = "/client/img/RedChip.png" class = "chips" style = "left: 580px;">
          <img src = "/client/img/WhiteChip.png" class = "chips" style = "left: 690px;">
        </div>
        <br>
      </div>

      <!-- Game chat html tags -->
      <div id = "chat-text" style = "width: 500px; height: 100px; overflow-y:scroll; border-style: solid;">
        <div>Welcome!</div>
      </div>
      <form onsubmit = "return userSubmission();">
        <input id = "chat-input" type = "text" style = "width: 500px;"></input>
      </form>

  </div>

  </body>
</html>
